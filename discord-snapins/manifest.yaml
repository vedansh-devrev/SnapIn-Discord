version: "1"

name: "e2e_snap_in"
description: "A snap-in to create a ticket on Discord"

connections:
  - name: devrev
    description: DevRev PAT
    types:
      - devrev-pat
  - name: discord
    description: "Discord OAuth"
    types:
      - devrev-discord-app
  - name: discord-bot-token
    description: "Discord bot token"
    types:
      - devrev-flow-secret

event-sources:
  - name: discord-app-interactions
    description: Events coming from Discord
    display_name: Discord
    type: discord-app-interactions
    connection: discord

functions:
  - name: discord-interactions
    description: Function to create a ticket on DevRev from Discord.

globals:
  - name: part_id
    description: ID of the part under which the DevRev ticket should be created.
    devrev_field_type: id
    devrev_id_type:
      - product
  - name: owner_id
    description: ID of the owner under which the DevRev ticket should be created.
    devrev_field_type: id
    devrev_id_type:
      - devu
  - name: stage  
    devrev_field_type: text
    description: Default stage for the created tickets.

automations:
  - name: Create_a_ticket_on_DevRev_from_Discord_using_DevRev_bot.
    source: discord-app-interactions
    event_types:
        - discord.interaction.application-command
        - discord.interaction.message-component
        - discord.interaction.modal-submit
    function: discord-interactions
